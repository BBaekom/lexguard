import { NextRequest, NextResponse } from "next/server";

export async function POST(req: NextRequest) {
  try {
    // 샘플 NDA 계약서 텍스트
    const sampleContractText = `표준비밀유지계약서

(2024. 12. 제정)

공정거래위원회

제1조 (계약의 목적)
본 계약은 원사업자와 수급사업자 간의 기술자료 제공 및 비밀유지에 관한 사항을 정함을 목적으로 한다.

제2조 (기술자료의 정의)
본 계약에서 "기술자료"라 함은 다음 각 호의 것을 말한다.
1. 제조, 수리, 건설 또는 서비스 수행 방법에 관한 정보 또는 자료
2. 수급사업자의 연구개발, 생산 및 판매 활동에 있어 기술적으로 유용하고 독립적인 경제적 가치를 가지는 지적재산권에 관한 기술적 정보 또는 자료

제3조 (기술자료의 목적외 사용금지)
원사업자는 수급사업자로부터 제공받은 기술자료를 첨부서류에 명시된 목적 외에는 사용할 수 없다.

제4조 (기술자료의 비밀유지 의무)
원사업자는 수급사업자의 사전 서면 동의 없이는 제공받은 기술자료를 타인에게 공개하거나 공표할 수 없다.

제5조 (기술자료의 반환 또는 폐기방법)
원사업자는 첨부서류에 정한 반환일까지 제공받은 기술자료의 원본을 수급사업자에게 즉시 반환하거나 폐기하여야 한다.`;

    // 샘플 분석 결과
    const sampleAnalysisResult = {
      contractType: "표준비밀유지계약서",
      completedAt: "2024-12-19 14:30:00",
      riskScore: 65,
      mainRisks: ["비밀유지 의무 위반 시 배상 조항 부재", "기술자료 정의의 모호성", "반환 의무의 구체성 부족"],
      contractText: sampleContractText,
      clauses: [
        {
          clause_number: "제1조",
          clause_title: "계약의 목적",
          clause_content: "본 계약은 원사업자와 수급사업자 간의 기술자료 제공 및 비밀유지에 관한 사항을 정함을 목적으로 한다.",
          risk_analysis: "계약의 목적이 명확하지만, 구체적인 범위와 한계가 명시되지 않아 해석상 분쟁 가능성이 있습니다.",
          risk_level: "중간",
          risk_score: 45,
          improvement: {
            original: "본 계약은 원사업자와 수급사업자 간의 기술자료 제공 및 비밀유지에 관한 사항을 정함을 목적으로 한다.",
            suggested: "본 계약은 원사업자와 수급사업자 간의 기술자료 제공 및 비밀유지에 관한 사항을 정함을 목적으로 하며, 계약의 범위와 한계는 첨부서류에 명시된 바에 따른다.",
            explanation: "계약의 범위와 한계를 명확히 하여 향후 해석상 분쟁을 방지할 수 있습니다."
          }
        },
        {
          clause_number: "제2조",
          clause_title: "기술자료의 정의",
          clause_content: "본 계약에서 '기술자료'라 함은 다음 각 호의 것을 말한다. 1. 제조, 수리, 건설 또는 서비스 수행 방법에 관한 정보 또는 자료 2. 수급사업자의 연구개발, 생산 및 판매 활동에 있어 기술적으로 유용하고 독립적인 경제적 가치를 가지는 지적재산권에 관한 기술적 정보 또는 자료",
          risk_analysis: "기술자료의 정의가 광범위하고 모호하여, 실제 적용 시 범위 해석에 분쟁이 발생할 수 있습니다.",
          risk_level: "높음",
          risk_score: 75,
          improvement: {
            original: "본 계약에서 '기술자료'라 함은 다음 각 호의 것을 말한다. 1. 제조, 수리, 건설 또는 서비스 수행 방법에 관한 정보 또는 자료 2. 수급사업자의 연구개발, 생산 및 판매 활동에 있어 기술적으로 유용하고 독립적인 경제적 가치를 가지는 지적재산권에 관한 기술적 정보 또는 자료",
            suggested: "본 계약에서 '기술자료'라 함은 첨부서류에 구체적으로 명시된 정보 또는 자료를 말하며, 다음 각 호의 것을 포함한다. 1. 제조, 수리, 건설 또는 서비스 수행 방법에 관한 정보 또는 자료 2. 수급사업자의 연구개발, 생산 및 판매 활동에 있어 기술적으로 유용하고 독립적인 경제적 가치를 가지는 지적재산권에 관한 기술적 정보 또는 자료",
            explanation: "기술자료의 범위를 첨부서류에 구체적으로 명시하도록 하여 해석상 분쟁을 방지할 수 있습니다."
          }
        },
        {
          clause_number: "제3조",
          clause_title: "기술자료의 목적외 사용금지",
          clause_content: "원사업자는 수급사업자로부터 제공받은 기술자료를 첨부서류에 명시된 목적 외에는 사용할 수 없다.",
          risk_analysis: "목적외 사용 금지 조항이 있지만, 위반 시 제재 조항이 명시되지 않아 실효성이 떨어집니다.",
          risk_level: "높음",
          risk_score: 80,
          improvement: {
            original: "원사업자는 수급사업자로부터 제공받은 기술자료를 첨부서류에 명시된 목적 외에는 사용할 수 없다.",
            suggested: "원사업자는 수급사업자로부터 제공받은 기술자료를 첨부서류에 명시된 목적 외에는 사용할 수 없다. 위반 시 수급사업자는 계약 해지 및 손해배상을 청구할 수 있다.",
            explanation: "위반 시 제재 조항을 추가하여 조항의 실효성을 높일 수 있습니다."
          }
        },
        {
          clause_number: "제4조",
          clause_title: "기술자료의 비밀유지 의무",
          clause_content: "원사업자는 수급사업자의 사전 서면 동의 없이는 제공받은 기술자료를 타인에게 공개하거나 공표할 수 없다.",
          risk_analysis: "비밀유지 의무는 명시되어 있지만, 위반 시 구체적인 배상 조항이 없어 실효성이 부족합니다.",
          risk_level: "높음",
          risk_score: 85,
          improvement: {
            original: "원사업자는 수급사업자의 사전 서면 동의 없이는 제공받은 기술자료를 타인에게 공개하거나 공표할 수 없다.",
            suggested: "원사업자는 수급사업자의 사전 서면 동의 없이는 제공받은 기술자료를 타인에게 공개하거나 공표할 수 없다. 위반 시 원사업자는 수급사업자에게 발생한 모든 손해를 배상하여야 한다.",
            explanation: "위반 시 배상 의무를 명시하여 비밀유지 의무의 실효성을 높일 수 있습니다."
          }
        },
        {
          clause_number: "제5조",
          clause_title: "기술자료의 반환 또는 폐기방법",
          clause_content: "원사업자는 첨부서류에 정한 반환일까지 제공받은 기술자료의 원본을 수급사업자에게 즉시 반환하거나 폐기하여야 한다.",
          risk_analysis: "반환 의무는 명시되어 있지만, 구체적인 반환 방법과 폐기 증명 방법이 명시되지 않았습니다.",
          risk_level: "중간",
          risk_score: 60,
          improvement: {
            original: "원사업자는 첨부서류에 정한 반환일까지 제공받은 기술자료의 원본을 수급사업자에게 즉시 반환하거나 폐기하여야 한다.",
            suggested: "원사업자는 첨부서류에 정한 반환일까지 제공받은 기술자료의 원본을 수급사업자에게 즉시 반환하거나 폐기하여야 한다. 폐기 시에는 폐기 증명서를 수급사업자에게 제출하여야 한다.",
            explanation: "폐기 증명서 제출 의무를 추가하여 반환 의무의 이행을 확실히 할 수 있습니다."
          }
        }
      ],
      summary: {
        riskScore: 65,
        mainRiskClauses: [
          { title: "기술자료의 비밀유지 의무", score: 85 },
          { title: "기술자료의 목적외 사용금지", score: 80 },
          { title: "기술자료의 정의", score: 75 }
        ],
        comment: "전반적으로 비밀유지계약서의 기본 구조는 갖추고 있으나, 위반 시 제재 조항과 구체적인 이행 방법이 부족하여 실효성이 떨어집니다. 특히 비밀유지 의무 위반 시 배상 조항과 기술자료 정의의 구체화가 필요합니다."
      }
    };

    // 분석 ID 생성 및 저장
    const analysisId = Math.random().toString(36).substring(2, 10);
    globalThis.analysisStore = globalThis.analysisStore || {};
    globalThis.analysisStore[analysisId] = sampleAnalysisResult;

    return NextResponse.json({ 
      analysisId,
      message: "샘플 분석 데이터가 생성되었습니다." 
    });
  } catch (error) {
    console.error('샘플 데이터 생성 중 오류 발생:', error);
    return NextResponse.json({ error: '샘플 데이터 생성에 실패했습니다.' }, { status: 500 });
  }
} 